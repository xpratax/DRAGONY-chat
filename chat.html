<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>H$KASS - Chat</title>
<style>
body {
    margin:0;
    font-family: monospace;
    background:#000;
    color:#0ff;
    text-align:center;
}
h1 {
    font-size: 50px;
    background: linear-gradient(90deg, cyan, magenta, pink, yellow);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-top:20px;
}
#chat-container {
    width:90%;
    max-width:800px;
    height:400px;
    background:#111;
    border:1px solid #0ff;
    overflow-y:auto;
    margin:20px auto;
    padding:10px;
    text-align:left;
}
input, button {
    padding:10px;
    margin:5px;
    width: calc(100% - 24px);
    border: 1px solid #0ff;
    background: #000;
    color: #0ff;
    font-weight:bold;
    font-size:16px;
}
button:hover {
    background:#0ff;
    color:#000;
    cursor:pointer;
}
</style>
</head>
<body>

<h1>H$KASS Chat</h1>
<div id="chat-container"></div>
<input type="text" id="msgInput" placeholder="Digite sua mensagem" onkeydown="if(event.key==='Enter'){sendMessage();}">
<button onclick="sendMessage()">Enviar</button>

<script>
let currentUser = JSON.parse(localStorage.getItem('HskassUser'));
if(!currentUser){
    alert("FaÃ§a login primeiro");
    window.location.href = "index.html";
}

const chatContainer = document.getElementById('chat-container');

async function sendMessage(){
    const input = document.getElementById('msgInput');
    if(input.value.trim()==='') return;

    try{
        const res = await fetch('/api/chat', {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({ username: currentUser.username, message: input.value })
        });
        const data = await res.json();
        displayMessages(data.messages);
    } catch(err){ console.error(err); }

    input.value='';
}

function displayMessages(msgs){
    chatContainer.innerHTML = '';
    msgs.forEach(m=>{
        const div = document.createElement('div');
        div.innerHTML = `<strong>${m.username}:</strong> ${m.message}`;
        chatContainer.appendChild(div);
    });
    chatContainer.scrollTop = chatContainer.scrollHeight;
}

// Atualiza chat a cada 2s
setInterval(async ()=>{
    try{
        const res = await fetch('/api/chat');
        const data = await res.json();
        displayMessages(data.messages);
    } catch(err){ console.error(err); }
},2000);
</script>
</body>
</html>
