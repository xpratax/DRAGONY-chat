<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>H$KASS</title>
<style>
body {
    margin:0;
    font-family: monospace;
    background:#000;
    color:#0ff;
    text-align:center;
}
h1 {
    font-size: 60px;
    background: linear-gradient(90deg, cyan, magenta, pink, yellow);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-top:20px;
}
img.logo {
    max-width: 150px;
    margin: 10px 0 20px 0;
    border: 2px solid #0ff;
    border-radius: 10px;
}
#loginDiv, #chatDiv {
    width:90%;
    max-width:400px;
    margin:auto;
}
input, button {
    padding:10px;
    margin:5px;
    width: calc(100% - 24px);
    border: 1px solid #0ff;
    background: #000;
    color: #0ff;
    font-weight:bold;
    font-size:16px;
}
button:hover {
    background:#0ff;
    color:#000;
    cursor:pointer;
}
#chat-container {
    background:#111;
    border:1px solid #0ff;
    height:400px;
    overflow-y:auto;
    padding:10px;
    margin-top:10px;
    text-align:left;
}
</style>
</head>
<body>

<h1>H$KASS</h1>
<img class="logo" src="https://i.postimg.cc/xkSmd25W/h.png" alt="Logo H$KASS"/>

<!-- Login -->
<div id="loginDiv">
    <input type="text" id="username" placeholder="Nome de usuário">
    <input type="password" id="password" placeholder="Senha">
    <button onclick="login()">Entrar</button>
</div>

<!-- Chat -->
<div id="chatDiv" style="display:none;">
    <div id="chat-container"></div>
    <input type="text" id="msgInput" placeholder="Digite sua mensagem" onkeydown="if(event.key==='Enter'){sendMessage();}">
    <button onclick="sendMessage()">Enviar</button>
</div>

<script>
let currentUser = null;
const chatContainer = document.getElementById('chat-container');

// Login local
async function login(){
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();
    if(!username){ alert("Digite um nome de usuário"); return; }

    try{
        const res = await fetch('/api/login', {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({ username, password })
        });
        const data = await res.json();
        currentUser = data;
        alert(`Logado como ${data.username} ${data.isMod ? '(Moderador)' : ''}`);

        document.getElementById('loginDiv').style.display='none';
        document.getElementById('chatDiv').style.display='block';
    } catch(err){ console.error(err); }
}

// Envio de mensagens
async function sendMessage(){
    if(!currentUser){ alert("Faça login primeiro"); return; }

    const input = document.getElementById('msgInput');
    if(input.value.trim()==='') return;

    try{
        const res = await fetch('/api/chat', {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({ username: currentUser.username, message: input.value })
        });
        const data = await res.json();
        displayMessages(data.messages);
    } catch(err){ console.error(err); }

    input.value='';
}

// Exibe mensagens
function displayMessages(msgs){
    chatContainer.innerHTML = '';
    msgs.forEach(m=>{
        const div = document.createElement('div');
        div.innerHTML = `<strong>${m.username}:</strong> ${m.message}`;
        chatContainer.appendChild(div);
    });
    chatContainer.scrollTop = chatContainer.scrollHeight;
}

// Atualiza chat a cada 2s
setInterval(async ()=>{
    try{
        const res = await fetch('/api/chat');
        const data = await res.json();
        displayMessages(data.messages);
    } catch(err){ console.error(err); }
},2000);
</script>

</body>
</html>

